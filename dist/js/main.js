(function(){var t,e,i,s,r,o,n=function(t,e){function i(){this.constructor=t}for(var s in e)a.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=function(){function t(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}return t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.copy=function(){return new t(this.x,this.y)},t.getRandom=function(e,i){return new t(Math.random()*(i-e)+e,Math.random()*(i-e)+e)},t}(),s=function(){function t(t){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.canvasWidth=this.canvas.width=400,this.canvasHeight=this.canvas.height=500,this.objects=[],this.controllable={},this.mouse=new i(this.canvasWidth/2,this.canvasHeight/2),this.params={gravity:new i(0,-.2)},this.canvas.addEventListener("mousemove",function(t){return function(e){var i;return i=[e.offsetX,e.offsetY],t.mouse.x=i[0],t.mouse.y=i[1],i}}(this),!1),this.canvas.addEventListener("mousewheel",function(t){return function(i){return i.preventDefault(),t.controllable instanceof e?i.shiftKey?t.controllable.scatter=Math.max(0,t.controllable.scatter-i.wheelDelta/100):i.altKey?t.controllable.particleSize=Math.max(0,t.controllable.particleSize-i.wheelDelta/100):t.controllable.particleLife=Math.max(1,t.controllable.particleLife-i.wheelDelta/10):void 0}}(this),!1)}return t.prototype.addObject=function(t,e,i){var s;return e.world=this,s=new t(e),i&&s.setControllable(),this.objects.push(s)},t.prototype.removeObject=function(t){return this.object.splice(t,1)},t.prototype.start=function(){return this.tick()},t.prototype.tick=function(){return this.update(),this.draw(),webkitRequestAnimationFrame(this.tick.bind(this))},t.prototype.update=function(){var t,e,i,s,r,o;for(r=this.objects,o=[],t=i=0,s=r.length;s>i;t=++i)e=r[t],e&&o.push(e.update(t));return o},t.prototype.draw=function(){var t,e,i,s,r;for(this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.globalAlpha=1,s=this.objects,r=[],e=0,i=s.length;i>e;e++)t=s[e],r.push(t.draw());return r},t}(),o=function(){function t(t){var e,s;this.loc=null!=(e=t.loc)?e:new i,this.speed=null!=(s=t.speed)?s:new i,this.world=t.world}return t.prototype.update=function(){return this instanceof e||this.speed.add(this.world.params.gravity),this.loc.add(this.speed)},t.prototype.notVisible=function(t){return this.loc.y>this.world.canvasHeight+t||this.loc.y<-t||this.loc.x>this.world.canvasWidth+t||this.loc.x<-t},t.prototype.setControllable=function(){return this.world.controllable=this,this.loc=this.world.mouse},t}(),e=function(e){function s(t){var e,i,r,o,n;s.__super__.constructor.call(this,t),this.particles=[],this.maxParticles=null!=(e=t.maxParticles)?e:300,this.particleLife=null!=(i=t.particleLife)?i:60,this.particleSize=null!=(r=t.particleSize)?r:24,this.creationRate=null!=(o=t.creationRate)?o:3,this.scatter=null!=(n=t.scatter)?n:1.3}return n(s,e),s.prototype.addParticle=function(e){return e.system=this,e.world=this.world,this.particles.push(new t(e))},s.prototype.removeParticle=function(t){return this.particles.splice(t,1)},s.prototype.update=function(){var t,e,s,r,o,n,a,l,c;if(!(this.particles.length>this.maxParticles))for(t=r=0,a=this.creationRate;a>=0?a>=r:r>=a;t=a>=0?++r:--r)this.addParticle({loc:this.loc.copy(),speed:i.getRandom(-this.scatter,this.scatter)});for(l=this.particles,c=[],e=o=0,n=l.length;n>o;e=++o)s=l[e],s&&c.push(s.update(e));return c},s.prototype.draw=function(){var t,e,i,s,r;for(s=this.particles,r=[],e=0,i=s.length;i>e;e++)t=s[e],r.push(t.draw());return r},s}(o),t=function(t){function e(t){e.__super__.constructor.call(this,t),this.system=t.system,this.initialLife=this.system.particleLife,this.life=this.initialLife,this.size=this.system.ParticleSystem}return n(e,t),e.prototype.update=function(t){return e.__super__.update.apply(this,arguments),this.size=Math.max(0,this.system.particleSize),this.notVisible(100)?this.system.removeParticle(t):void 0},e.prototype.draw=function(){var t;return this.world.ctx.globalCompositeOperation="lighter",this.world.ctx.globalAlpha=this.life/this.initialLife,t=this.world.ctx.createRadialGradient(this.loc.x,this.loc.y,0,this.loc.x,this.loc.y,this.size),t.addColorStop(0,"rgba(226, 88, 34,.5)"),t.addColorStop(.3,"rgba(226, 88, 34,.3)"),t.addColorStop(1,"transparent"),this.world.ctx.fillStyle=t,this.world.ctx.beginPath(),this.world.ctx.arc(this.loc.x,this.loc.y,this.size,0,2*Math.PI),this.world.ctx.fill()},e}(o),r=new s(document.getElementById("canvas")),window.test=r,r.addObject(e,{loc:new i(200,400),particleSize:30,particleLife:55,scatter:.4},!0),r.start()}).call(this);